# Microservices
### 1. config-cloud-server
Цель и постановка задания: В процессе выполнения заданий ознакомиться с возможностями Spring Cloud Config Server. 

Задание 1
* Создать Spring Cloud Config Server приложение. Помимо файла с общими настройками описать файл с настройками для 
user-service и company-service. Файлы с настройками должны содержать: порт, на котором запуститься микросервис, 
описание микросервиса. 

Задание 2 
* Создать настройку для test профайла spring для user-service. Переопределить в ней описание микросервиса c 
использованием environment файла. 

Задание 3 
* Создать два микросервиса: user-service, company-service. Настроить их подключение к Config Server. Создать файл для 
чтения конфигурации. Создать rest контроллер с get методом, который будет возвращать описание микросервиса из 
конфигурации. Убедиться что описание сервисов возвращается корректно. 

Задание 4 
* Добавить конфигурацию для запуска user-service с тестовым профайлом. Убедиться что описание сервиса возвращается 
корректно.

### 2. Взаимодействие микросервисов
Задание 1
* Установить Docker. Создать docker-compose.yaml файл, в котором описать необходимые для работы сервисы (postgresql). Добавить
настройки подключения к созданной базе данных для user-service и company-service (для каждого микросервиса укажите свою
схему данных).

Задание 2
* Подключить фреймворк для управления миграциями баз данных FlyWay в user-service и company-service. Создайте скрипт для
создания таблицы user (имя, логин, пароль, емэйл, признак активации/деактивации, идентификатор компании). Для company-
service создайте скрипт для создания таблицы компаний (название, огрн, описание дейтельности, идентификатор директора).

Задание 3
* Создайте соответствующие Entity, Dto (для пользователей должно возвращаться название компании, для компаний – ФИО
пользователя), Repository, Service для таблиц из задания 2

Задание 4

Создайте контроллер в user-service, в котором реализуйте следующие end-points:
* Получение списка всех пользователей (информация о компании должна подтягиваться синхронное из company-service)
* Активация/деактивация пользователя
* Создание пользователя (должна быть синхронная проверка из company-service, на существование компании. Если компании не существует –
кидать 404 ошибку с соответствующим сообщением)
* Обновление информации о пользователе (только имя, емэйл и компанию, для компании должна быть проверка см. выше )
* Проверка существования пользователя по идентификатору (если пользователь существует, но неактивен – тоже кидаем 404 ошибку)

Создайте контроллер в company-service, в котором реализуйте следующие end-points:
* Проверка существования компании по ее идентификатору
* Получение списка всех компаний (с ФИО директора)
* Создание компании (должна быть синхронная проверка из user-service, на существование директора. Если директора не существует – кидать 404
ошибку с соответствующим сообщением)

### 3. Service discovery, Api Gateway. 
### В процессе выполнения заданий подключить службу обнаружения микросервисов и настроить api шлюз.
Задание 1

* Создать новое Spring Boot приложение – Discovery server. В качестве службы обнаружения микросервисов можно использовать eureka.

Задание 2

* Зарегистрируйте ваши микросервисы (user и company) в созданном Discovery server.

Задание 3

* Создайте новое Spring boot приложение – Api Gateway. Зарегистрируйте его в Discovery server

Задание 4

* Задайте маршруты в Api gateway таким образом, чтобы все запросы, которые идут по адресу …/user/… были перенаправлены в user-service, а все
запросы по адресу …/company/… в company-service. Проверьте работоспособность приложения.

Задание 5

* Поправьте url в своих feign clients, таким образом, чтобы вызов сервисов осуществлялся через api gateway. Проверьте работоспособность приложения.

### 4. Kafka. Получение навыков асинхронного взаимодействия микросервисов.
Задание 1 

* Добавить в docker-compose файл новый сервис для Kafka. 

Задание 2 

* Обновить configuration server, добавив в него новые настройки для kafka. 

Задание 3 

* Создать ендпоинт для удаления компании (компания помечается удаленной и перестает искаться в ендпоинте для поиска компаний, физически из БД компания на данном этапе не удаляется). 
Если компании по id не существует – кидаем 404 ошибку. При удалении компании должно отправляться сообщение в user сервис через Kafka. При получении сообщения в юзер сервисе, ищутся все пользователи, работающие в данной компании, и поле company_id для них сбрасывается в null. После этого отправляется сообщение в company service, по которому компания физически удалятся из БД. 

Задание 4 

* Продемонстрировать работу ендпоинта удаления компании.